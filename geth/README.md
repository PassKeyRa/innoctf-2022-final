# Приватный блокчейн Geth

Используется для тасков smartchat-contract и smartchat-web. После настройки блокчейна необходимо поменять RPC url:

* в сервисе smartchat-contract, файлах `deploy/truffle-config.js`, `cli/lib.py`

* в сервисе smartchat-web, файле `app/index.js`

* в чекере smartchat-contract, файле `lib.py`

## Описание

Конфигурация поднимает блокчейн geth ([https://geth.ethereum.org/](https://geth.ethereum.org/)) с протоколом Clique (proof of authority), инициализируя заранее кошельки для ноды, чекера и команд. Блоки создаются каждую секунду. Во время старта блокчейн делает unlock всех перечисленных аккаунтов, просто так добавить свой новый кошелек через RPC и подписывать транзакции не получится, все должно быть инициализировано заранее.

## Deploy

Для деплоя нужно скопировать на машину в одну директорию файлы `genesis.json`, `install.sh`, `password.txt` и директорию с заранее сгенерированными кошельками `wallets`. После чего запускаем `install.sh`

Если все пройдет успешно, то на порту 8545 должен запуститься блокчейн

## Запуск сервисов на блокчейне

Для запуска нужно

* Поменять RPC url, если требуется (см. выше)

* выбрать приватный ключ команды из `wallets/teams` и скопировать его по путям `services/smartchat-contract/deploy/.secret` и `services/smartchat-web/.secret`

После чего можно запускать докер smartchat-contract, который задеплоит контракт. Далее адрес контракта (будет отдаваться api на `127.0.0.1:8001/contract` после деплоя, там же его будет брать чекер) подставляем в environment сервиса smartchat-web и тоже запускаем
